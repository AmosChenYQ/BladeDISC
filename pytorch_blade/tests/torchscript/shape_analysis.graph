// RUN: shape_analysis_tool <%s | FileCheck %s

// CHECK-LABEL: graph
graph(%p1 : Float(48, 128, 768, requires_grad=0),
      %p2 : Float(1, 128, 768, requires_grad=0),
      %p3 : int):
// CHECK: Float(*, *, *) = aten::add(%p1, %p2, %p3)
  %1 : Tensor = aten::add(%p1, %p2, %p3)
  return (%1)

// CHECK-LABEL: graph
graph(%p1 : Float(1, 512, requires_grad=0, device=cpu)):
  %1 : int = prim::Constant[value=0]()
  %2 : int = prim::Constant[value=1]()
// CHECK: Float(1, 512, requires_grad=0, device=cpu) = aten::slice(%p1, %1, %1, %2, %2)
  %3 : Tensor = aten::slice(%p1, %1, %1, %2, %2)
  return (%3)

// CHECK-LABEL: graph
graph(%p1 : Float(*, *, *, requires_grad=0),
      %p2 : Float(*, *, *, requires_grad=0),
      %p3 : int):
// CHECK: Float(*, *, *) = aten::add(%p1, %p2, %p3)
  %1 : Tensor = aten::add(%p1, %p2, %p3)
  return (%1)

// CHECK-LABEL: graph
graph(%p1 : Float(*, *, requires_grad=0, device=cpu)):
  %1 : int = prim::Constant[value=0]()
  %2 : int = prim::Constant[value=1]()
// CHECK: Float(*, *, requires_grad=0, device=cpu) = aten::slice(%p1, %1, %1, %2, %2)
  %3 : Tensor = aten::slice(%p1, %1, %1, %2, %2)
  return (%3)

// CHECK-LABEL: graph
graph(%p1 : Float(8, 512, 768, device=cuda:0),
      %p2 : Float(8, 512, 768, device=cuda:0)):
// CHECK: Float(*, *, *, device=cuda:0) = aten::tanh_backward(%p1, %p2)
  %1 : Tensor = aten::tanh_backward(%p1, %p2)
  return (%1)

// CHECK-LABEL: graph
graph(%p1 : Float(*, *, *, device=cuda:0),
      %p2 : Float(*, *, *, device=cuda:0)):
// CHECK: Float(*, *, *, device=cuda:0) = aten::tanh_backward(%p1, %p2)
  %1 : Tensor = aten::tanh_backward(%p1, %p2)
  return (%1)

// CHECK-LABEL: graph
graph(%p1 : Float(2, 3, 4, device=cuda:0)):
  %1 : bool = prim::Constant[value=1]()
  %2 : bool = prim::Constant[value=0]()
  %3 : int = prim::Constant[value=5]()
  %4 : int = prim::Constant[value=15]()
// CHECK: Half(2, 3, 4, device=cuda:0) = aten::_autocast_to_reduced_precision(%p1, %1, %2, %3, %4)
  %4 : Tensor = aten::_autocast_to_reduced_precision(%p1, %1, %2, %3, %4)
  return (%4)


// CHECK-LABEL: graph
graph(%p1 : Float(*, *, *, device=cuda:0)):
  %1 : bool = prim::Constant[value=1]()
  %2 : bool = prim::Constant[value=0]()
  %3 : int = prim::Constant[value=5]()
  %4 : int = prim::Constant[value=15]()
// CHECK: Half(*, *, *, device=cuda:0) = aten::_autocast_to_reduced_precision(%p1, %1, %2, %3, %4)
  %4 : Tensor = aten::_autocast_to_reduced_precision(%p1, %1, %2, %3, %4)
  return (%4)

// CHECK-LABEL: graph
graph(%p1 : Half(2, 3, 4, device=cuda:0)):
  %1 : bool = prim::Constant[value=1]()
  %2 : bool = prim::Constant[value=0]()
// CHECK: Float(2, 3, 4, device=cuda:0) = aten::_autocast_to_full_precision(%p1, %1, %2)
  %2 : Tensor = aten::_autocast_to_full_precision(%p1, %1, %2)
  return (%2)

// CHECK-LABEL: graph
graph(%p1 : Half(*, *, *, device=cuda:0)):
  %1 : bool = prim::Constant[value=1]()
  %2 : bool = prim::Constant[value=0]()
// CHECK: Float(*, *, *, device=cuda:0) = aten::_autocast_to_full_precision(%p1, %1, %2)
  %2 : Tensor = aten::_autocast_to_full_precision(%p1, %1, %2)
  return (%2)
